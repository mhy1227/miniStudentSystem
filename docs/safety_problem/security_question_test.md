# 安全问题验证机制测试流程

## 一、测试环境准备

### 1. 数据库准备
1. 确保以下表已创建且结构正确：
   - `security_question`：安全问题表
   - `question_template`：问题模板表

2. 初始化测试数据：
```sql
-- 插入测试问题模板
INSERT INTO question_template (question, category) VALUES 
('您的出生地是？', 'PERSONAL'),
('您母亲的姓名是？', 'FAMILY'),
('您的小学班主任是？', 'EDUCATION');

-- 准备测试用户（如果需要）
INSERT INTO student (sno, name, pwd) VALUES 
('test001', '测试用户1', '123456'),
('test002', '测试用户2', '123456');
```

### 2. 环境检查
1. 确保所有静态资源可访问：
   - `js/bootstrap/css/bootstrap.min.css`
   - `js/jquery/jquery.min.js`
   - `js/bootstrap/js/bootstrap.min.js`

2. 检查API接口可用性：
   - `/api/auth/login`
   - `/api/auth/verify-login`
   - `/api/auth/reset-password`
   - `/api/security/questions`

## 二、功能测试用例

### 1. 安全问题设置功能

#### 1.1 首次设置安全问题
1. 测试步骤：
   - 登录系统
   - 点击导航栏"安全设置"
   - 选择安全问题
   - 输入答案并提交

2. 测试数据：
   - 学号：test001
   - 安全问题：您的出生地是？
   - 答案：北京

3. 预期结果：
   - 设置成功提示
   - 数据库记录正确保存

#### 1.2 修改安全问题
1. 测试步骤：
   - 登录已设置安全问题的账号
   - 进入安全设置
   - 修改现有问题答案

2. 测试数据：
   - 学号：test001
   - 新答案：上海

3. 预期结果：
   - 更新成功提示
   - 数据库记录更新

### 2. 异地登录验证功能

#### 2.1 正常验证流程
1. 测试步骤：
   - 在不同IP登录已设置安全问题的账号
   - 等待弹出验证窗口
   - 输入正确答案

2. 测试数据：
   - 学号：test001
   - 密码：123456
   - 安全问题答案：上海

3. 预期结果：
   - 验证成功
   - 自动登录系统
   - 原登录会话失效

#### 2.2 验证失败处理
1. 测试步骤：
   - 在不同IP登录
   - 输入错误答案

2. 测试数据：
   - 学号：test001
   - 密码：123456
   - 错误答案：广州

3. 预期结果：
   - 显示验证失败提示
   - 允许重新输入
   - 记录失败次数

### 3. 密码重置功能

#### 3.1 通过安全问题重置密码
1. 测试步骤：
   - 点击登录页"忘记密码"
   - 输入学号
   - 回答安全问题
   - 设置新密码

2. 测试数据：
   - 学号：test001
   - 安全问题答案：上海
   - 新密码：test123
   - 确认密码：test123

3. 预期结果：
   - 密码重置成功
   - 自动跳转到登录页
   - 可使用新密码登录

#### 3.2 异常情况处理
1. 测试场景：
   - 未设置安全问题
   - 答案错误
   - 新密码不一致
   - 重置Token无效

2. 测试数据：
   - 学号：test002（未设置安全问题）
   - 错误答案测试
   - 密码：test123/test456

3. 预期结果：
   - 显示对应错误提示
   - 保持在当前步骤
   - 允许重新操作

## 三、安全性测试

### 1. 答案验证机制
1. 测试要点：
   - 答案大小写敏感性
   - 空格处理
   - 特殊字符处理

2. 测试数据：
   - 原答案：上海
   - 测试输入：
     - "上海 "（带空格）
     - "上 海"（中间空格）
     - "Shanghai"（英文）
     - "   上海   "（首尾空格）

3. 预期结果：
   - 标准化处理后正确匹配
   - 记录原始答案

### 2. 防暴力破解
1. 测试要点：
   - 连续失败次数限制
   - 账号锁定机制
   - 锁定时间控制

2. 测试步骤：
   - 连续输入错误答案
   - 观察锁定机制
   - 等待锁定时间后重试

3. 预期结果：
   - 达到限制次数后锁定
   - 显示剩余锁定时间
   - 锁定期间禁止验证

### 3. 会话安全
1. 测试要点：
   - 验证Token有效性
   - 会话劫持防护
   - 异地登录互斥

2. 测试场景：
   - 重复使用验证Token
   - 多地同时登录
   - 会话超时处理

3. 预期结果：
   - Token一次性使用
   - 强制登录后旧会话失效
   - 超时自动退出

## 四、性能测试

### 1. 并发处理
1. 测试场景：
   - 多用户同时设置安全问题
   - 多地登录验证
   - 并发密码重置

2. 测试工具：
   - JMeter或类似压测工具
   - 并发用户数：50
   - 持续时间：5分钟

3. 预期指标：
   - 响应时间 < 2秒
   - 错误率 < 1%
   - 数据一致性保持

### 2. 异常恢复
1. 测试场景：
   - 数据库连接中断
   - 网络超时
   - 服务重启

2. 测试步骤：
   - 模拟故障情况
   - 执行各项功能
   - 观察恢复情况

3. 预期结果：
   - 友好的错误提示
   - 数据完整性保持
   - 服务自动恢复

## 五、兼容性测试

### 1. 浏览器兼容性
1. 测试环境：
   - Chrome最新版
   - Firefox最新版
   - Edge最新版
   - Safari最新版

2. 测试内容：
   - 页面布局
   - 功能完整性
   - 交互响应

3. 预期结果：
   - 显示正常
   - 功能正常
   - 体验一致

### 2. 设备适配
1. 测试设备：
   - 桌面电脑
   - 笔记本电脑
   - 平板电脑
   - 手机

2. 测试要点：
   - 响应式布局
   - 触屏操作
   - 页面缩放

3. 预期结果：
   - 自适应显示
   - 操作流畅
   - 功能完整

## 六、测试报告模板

### 1. 基本信息
- 测试时间：YYYY-MM-DD
- 测试环境：开发环境/测试环境/生产环境
- 测试人员：姓名
- 测试版本：v1.0.0

### 2. 测试结果汇总
| 测试类型 | 用例数 | 通过数 | 失败数 | 通过率 |
|---------|--------|--------|--------|--------|
| 功能测试 |        |        |        |        |
| 安全测试 |        |        |        |        |
| 性能测试 |        |        |        |        |
| 兼容性测试|        |        |        |        |

### 3. 问题记录
| 问题描述 | 严重程度 | 优先级 | 状态 | 备注 |
|---------|----------|--------|------|------|
|         |          |        |      |      |

### 4. 改进建议
1. 功能建议：
   - 
   - 

2. 性能建议：
   - 
   - 

3. 安全建议：
   - 
   - 
``` 
</rewritten_file>
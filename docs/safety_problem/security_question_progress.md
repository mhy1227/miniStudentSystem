# å®‰å…¨é—®é¢˜éªŒè¯æœºåˆ¶å®æ–½è¿›åº¦ä¸è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€å½“å‰è¿›åº¦

**é¡¹ç›®åç§°**ï¼šå®‰å…¨é—®é¢˜éªŒè¯æœºåˆ¶  
**å½“å‰çŠ¶æ€**ï¼šå¼€å‘é˜¶æ®µ  
**å®Œæˆåº¦**ï¼š45%  
**å¼€å§‹æ—¥æœŸ**ï¼š2025å¹´4æœˆ10æ—¥  
**é¢„è®¡å®Œæˆæ—¥æœŸ**ï¼š2025å¹´5æœˆ10æ—¥  

### é‡Œç¨‹ç¢‘è¿›åº¦

| é˜¶æ®µ | çŠ¶æ€ | å¼€å§‹æ—¥æœŸ | å®Œæˆ/é¢„è®¡æ—¥æœŸ | è´Ÿè´£äºº |
|------|------|----------|--------------|--------|
| éœ€æ±‚åˆ†æ | âœ… å·²å®Œæˆ | 2025-04-08 | 2025-04-10 | ç³»ç»Ÿç®¡ç†å‘˜ |
| è®¾è®¡æ–¹æ¡ˆ | âœ… å·²å®Œæˆ | 2025-04-10 | 2025-04-12 | ç³»ç»Ÿç®¡ç†å‘˜ |
| æ•°æ®åº“è®¾è®¡ | âœ… å·²å®Œæˆ | 2025-04-10 | 2025-04-12 | ç³»ç»Ÿç®¡ç†å‘˜ |
| åç«¯å¼€å‘ | ğŸ”„ è¿›è¡Œä¸­ | 2025-04-12 | 2025-04-25 | ç³»ç»Ÿç®¡ç†å‘˜ |
| å‰ç«¯å¼€å‘ | â³ æœªå¼€å§‹ | 2025-04-20 | 2025-05-05 | å¾…å®š |
| æµ‹è¯•ä¸ä¸Šçº¿ | â³ æœªå¼€å§‹ | 2025-05-05 | 2025-05-10 | å¾…å®š |

### å·²å®Œæˆå·¥ä½œ

- [x] éœ€æ±‚åˆ†ææ–‡æ¡£
- [x] ç”¨æˆ·åœºæ™¯æ¢³ç†
- [x] å¼‚åœ°ç™»å½•ä¸å®‰å…¨é—®é¢˜éªŒè¯æµç¨‹è®¨è®º
- [x] å®‰å…¨é—®é¢˜åº”ç”¨åœºæ™¯ç¡®å®šï¼šå¼‚åœ°ç™»å½•æ£€æµ‹å’Œå¯†ç é‡ç½®
- [x] æ•°æ®åº“è¡¨è®¾è®¡å®Œæˆ
- [x] APIæ¥å£è®¾è®¡å®Œæˆ
- [x] æ ¸å¿ƒæœåŠ¡æ¥å£å®ç°
- [x] ä¸ç™»å½•ç³»ç»Ÿé›†æˆå®Œæˆ

### è¿›è¡Œä¸­å·¥ä½œ

- [ ] å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] æ·»åŠ æ—¥å¿—è®°å½•
- [ ] å®ç°å‰ç«¯é¡µé¢
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

## äºŒã€ç®€åŒ–è®¾è®¡æ–¹æ¡ˆ

### 1. æ€»ä½“æ¶æ„

å®‰å…¨é—®é¢˜éªŒè¯æœºåˆ¶å°†æ•´åˆåˆ°ç°æœ‰çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿä¸­ï¼Œä¸»è¦åº”ç”¨äºä¸¤ä¸ªåœºæ™¯ï¼š
1. å¼‚åœ°ç™»å½•æ£€æµ‹æ—¶çš„èº«ä»½éªŒè¯
2. å¯†ç é‡ç½®/æ‰¾å›æµç¨‹

é‡‡ç”¨ç®€åŒ–çš„å®ç°ç­–ç•¥ï¼š
- æ¯ä¸ªç”¨æˆ·åªéœ€è®¾ç½®ä¸€ä¸ªå®‰å…¨é—®é¢˜å’Œç­”æ¡ˆ
- ä½¿ç”¨ç°æœ‰ç”¨æˆ·è¡¨è¿›è¡Œæ‰©å±•ï¼Œé¿å…å¤æ‚çš„è¡¨å…³è”
- å…ˆå®ç°åŸºç¡€åŠŸèƒ½ï¼Œåç»­å†ä¼˜åŒ–æ‰©å±•

### 2. æ•°æ®åº“è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰

é€‰æ‹©ç›´æ¥åœ¨å­¦ç”Ÿè¡¨ï¼ˆstudentï¼‰ä¸­æ·»åŠ å®‰å…¨é—®é¢˜ç›¸å…³å­—æ®µï¼Œç®€åŒ–è¡¨ç»“æ„å’ŒæŸ¥è¯¢é€»è¾‘ã€‚

**å­¦ç”Ÿè¡¨æ‰©å±•å­—æ®µï¼š**
```sql
ALTER TABLE `student` 
ADD COLUMN `security_question` VARCHAR(255) NULL COMMENT 'å®‰å…¨é—®é¢˜',
ADD COLUMN `security_answer_hash` VARCHAR(128) NULL COMMENT 'å®‰å…¨é—®é¢˜ç­”æ¡ˆ(å“ˆå¸Œ)',
ADD COLUMN `security_answer_salt` VARCHAR(32) NULL COMMENT 'å®‰å…¨é—®é¢˜ç­”æ¡ˆç›å€¼'; 
```

è¿™ç§è®¾è®¡çš„ä¼˜ç‚¹ï¼š
- å®ç°ç®€å•ï¼Œæ— éœ€åˆ›å»ºé¢å¤–çš„è¡¨
- æŸ¥è¯¢é«˜æ•ˆï¼Œç›´æ¥é€šè¿‡å­¦å·è·å–å®‰å…¨é—®é¢˜å’Œç­”æ¡ˆ
- ä¾¿äºä¸ç°æœ‰åŠŸèƒ½é›†æˆ

ç¼ºç‚¹ï¼ˆåæœŸå¯ä¼˜åŒ–ï¼‰ï¼š
- æ¯ä¸ªç”¨æˆ·åªèƒ½è®¾ç½®ä¸€ä¸ªå®‰å…¨é—®é¢˜
- æ— æ³•è®°å½•éªŒè¯å°è¯•å†å²

### 3. æ ¸å¿ƒç±»è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰

#### å®‰å…¨é—®é¢˜æœåŠ¡æ¥å£
```java
public interface SecurityQuestionService {
    // è®¾ç½®ç”¨æˆ·å®‰å…¨é—®é¢˜
    boolean setSecurityQuestion(String sno, String question, String answer);
    
    // è·å–ç”¨æˆ·çš„å®‰å…¨é—®é¢˜
    String getSecurityQuestion(String sno);
    
    // éªŒè¯å®‰å…¨é—®é¢˜ç­”æ¡ˆ
    boolean verifySecurityAnswer(String sno, String answer);
    
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¾ç½®å®‰å…¨é—®é¢˜
    boolean hasSetSecurityQuestion(String sno);
}
```

#### å®‰å…¨é—®é¢˜æœåŠ¡å®ç°
```java
@Service
public class SecurityQuestionServiceImpl implements SecurityQuestionService {
    @Resource
    private StudentMapper studentMapper;
    
    // è®¾ç½®å®‰å…¨é—®é¢˜
    @Override
    public boolean setSecurityQuestion(String sno, String question, String answer) {
        // ç”Ÿæˆéšæœºç›å€¼
        String salt = generateSalt();
        // å“ˆå¸Œå¤„ç†ç­”æ¡ˆ
        String hashedAnswer = hashWithSalt(answer, salt);
        
        // æ›´æ–°å­¦ç”Ÿè¡¨
        return studentMapper.updateSecurityQuestion(sno, question, hashedAnswer, salt) > 0;
    }
    
    // è·å–å®‰å…¨é—®é¢˜
    @Override
    public String getSecurityQuestion(String sno) {
        Student student = studentMapper.selectByStudentNo(sno);
        return student != null ? student.getSecurityQuestion() : null;
    }
    
    // éªŒè¯ç­”æ¡ˆ
    @Override
    public boolean verifySecurityAnswer(String sno, String answer) {
        Student student = studentMapper.selectByStudentNo(sno);
        if (student == null || student.getSecurityAnswerHash() == null) {
            return false;
        }
        
        String hashedInput = hashWithSalt(answer, student.getSecurityAnswerSalt());
        return hashedInput.equals(student.getSecurityAnswerHash());
    }
    
    // æ£€æŸ¥æ˜¯å¦è®¾ç½®
    @Override
    public boolean hasSetSecurityQuestion(String sno) {
        Student student = studentMapper.selectByStudentNo(sno);
        return student != null && student.getSecurityQuestion() != null;
    }
    
    // ç”Ÿæˆç›å€¼
    private String generateSalt() {
        byte[] salt = new byte[16];
        new SecureRandom().nextBytes(salt);
        return Base64.getEncoder().encodeToString(salt);
    }
    
    // å“ˆå¸Œå‡½æ•°
    private String hashWithSalt(String answer, String salt) {
        String normalizedAnswer = answer.trim().toLowerCase();
        try {
            MessageDigest md = MessageDigest.getInstance("SHA-256");
            md.update(salt.getBytes());
            byte[] bytes = md.digest(normalizedAnswer.getBytes());
            StringBuilder sb = new StringBuilder();
            for (byte b : bytes) {
                sb.append(String.format("%02x", b));
            }
            return sb.toString();
        } catch (NoSuchAlgorithmException e) {
            throw new RuntimeException("å“ˆå¸Œç®—æ³•ä¸å¯ç”¨", e);
        }
    }
}
```

### 4. APIæ¥å£è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰

#### å®‰å…¨é—®é¢˜è®¾ç½®

```
1. è®¾ç½®å®‰å…¨é—®é¢˜
POST /api/security-question/set
Request:
{
  "question": "æ‚¨çš„å‡ºç”Ÿåœ°æ˜¯ï¼Ÿ",
  "answer": "åŒ—äº¬"
}
Response:
{
  "code": 200,
  "message": "å®‰å…¨é—®é¢˜è®¾ç½®æˆåŠŸ",
  "data": true
}

2. è·å–å®‰å…¨é—®é¢˜
GET /api/security-question
Response:
{
  "code": 200,
  "message": "success",
  "data": {
    "hasSet": true,
    "question": "æ‚¨çš„å‡ºç”Ÿåœ°æ˜¯ï¼Ÿ"
  }
}
```

#### å¼‚åœ°ç™»å½•éªŒè¯

```
1. è·å–å®‰å…¨é—®é¢˜ï¼ˆå¼‚åœ°ç™»å½•æ—¶ï¼‰
POST /api/auth/remote-login/question
Request:
{
  "sno": "XH202501",
  "password": "encoded_password"
}
Response:
{
  "code": 202,
  "message": "éœ€è¦å®‰å…¨éªŒè¯",
  "data": {
    "question": "æ‚¨çš„å‡ºç”Ÿåœ°æ˜¯ï¼Ÿ",
    "verifyToken": "xyz123"
  }
}

2. éªŒè¯å®‰å…¨é—®é¢˜ï¼ˆå¼‚åœ°ç™»å½•æ—¶ï¼‰
POST /api/auth/remote-login/verify
Request:
{
  "sno": "XH202501",
  "answer": "åŒ—äº¬",
  "verifyToken": "xyz123"
}
Response:
{
  "code": 200,
  "message": "éªŒè¯æˆåŠŸ",
  "data": {
    "token": "jwt_token",
    "userInfo": {
      // ç”¨æˆ·ä¿¡æ¯
    }
  }
}
```

#### å¯†ç é‡ç½®

```
1. å‘èµ·å¯†ç é‡ç½®
POST /api/password/reset-request
Request:
{
  "sno": "XH202501"
}
Response:
{
  "code": 200,
  "message": "è¯·å›ç­”å®‰å…¨é—®é¢˜",
  "data": {
    "question": "æ‚¨çš„å‡ºç”Ÿåœ°æ˜¯ï¼Ÿ",
    "resetToken": "abc456"
  }
}

2. éªŒè¯å¹¶é‡ç½®å¯†ç 
POST /api/password/reset
Request:
{
  "sno": "XH202501",
  "answer": "åŒ—äº¬",
  "newPassword": "new_password",
  "resetToken": "abc456"
}
Response:
{
  "code": 200,
  "message": "å¯†ç é‡ç½®æˆåŠŸ",
  "data": true
}
```

### 5. å‰ç«¯ç•Œé¢è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰

#### å®‰å…¨é—®é¢˜è®¾ç½®ç•Œé¢
- ä½ç½®ï¼šç”¨æˆ·ä¸ªäººä¸­å¿ƒé¡µé¢ â†’ å®‰å…¨è®¾ç½®
- ç»„ä»¶ï¼š
  - å®‰å…¨é—®é¢˜è¾“å…¥æ¡†ï¼ˆæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é—®é¢˜ï¼‰
  - å®‰å…¨é—®é¢˜ç­”æ¡ˆè¾“å…¥æ¡†
  - ä¿å­˜æŒ‰é’®

#### å¼‚åœ°ç™»å½•éªŒè¯ç•Œé¢
- ä½ç½®ï¼šç™»å½•è¿‡ç¨‹ä¸­çš„å¼¹çª—
- ç»„ä»¶ï¼š
  - å®‰å…¨æç¤ºæ–‡æœ¬
  - å®‰å…¨é—®é¢˜æ˜¾ç¤º
  - ç­”æ¡ˆè¾“å…¥æ¡†
  - éªŒè¯æŒ‰é’®
  - å–æ¶ˆæŒ‰é’®

#### å¯†ç é‡ç½®ç•Œé¢
- ä½ç½®ï¼šç™»å½•é¡µé¢çš„"å¿˜è®°å¯†ç "å…¥å£
- æ­¥éª¤ï¼š
  1. è¾“å…¥å­¦å·é¡µé¢
  2. å®‰å…¨é—®é¢˜éªŒè¯é¡µé¢
  3. è®¾ç½®æ–°å¯†ç é¡µé¢

## ä¸‰ã€å®æ–½è®¡åˆ’ï¼ˆç®€åŒ–ç‰ˆï¼‰

### 1. ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½ï¼ˆ1å‘¨ï¼‰
- æ•°æ®åº“å­—æ®µæ·»åŠ 
- å®‰å…¨é—®é¢˜æœåŠ¡å®ç°
- å®‰å…¨é—®é¢˜è®¾ç½®åŠŸèƒ½

### 2. ç¬¬äºŒé˜¶æ®µï¼šå¼‚åœ°ç™»å½•éªŒè¯ï¼ˆ1å‘¨ï¼‰
- ç™»å½•æ§åˆ¶å™¨ä¿®æ”¹
- å¼‚åœ°ç™»å½•éªŒè¯æµç¨‹
- å‰ç«¯éªŒè¯ç•Œé¢

### 3. ç¬¬ä¸‰é˜¶æ®µï¼šå¯†ç é‡ç½®åŠŸèƒ½ï¼ˆ1å‘¨ï¼‰
- å¯†ç é‡ç½®æµç¨‹å®ç°
- å‰ç«¯ç•Œé¢å¼€å‘
- æµ‹è¯•ä¸ä¸Šçº¿

## å››ã€æ³¨æ„äº‹é¡¹

1. **å®‰å…¨æ€§ä¿è¯**ï¼š
   - å³ä½¿ç®€åŒ–è®¾è®¡ï¼Œä¹Ÿè¦ç¡®ä¿ç­”æ¡ˆå®‰å…¨å­˜å‚¨ï¼ˆå“ˆå¸Œ+ç›å€¼ï¼‰
   - é™åˆ¶éªŒè¯å¤±è´¥æ¬¡æ•°ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£

2. **ç”¨æˆ·ä½“éªŒ**ï¼š
   - æä¾›é»˜è®¤çš„å®‰å…¨é—®é¢˜ç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·é€‰æ‹©åˆé€‚çš„é—®é¢˜
   - æç¤ºç”¨æˆ·é€‰æ‹©å®¹æ˜“è®°ä½ä½†ä»–äººéš¾ä»¥çŒœæµ‹çš„ç­”æ¡ˆ

3. **å‘åå…¼å®¹**ï¼š
   - åœ¨ç”¨æˆ·é¦–æ¬¡ç™»å½•æ—¶æç¤ºè®¾ç½®å®‰å…¨é—®é¢˜
   - å¯¹äºæœªè®¾ç½®å®‰å…¨é—®é¢˜çš„ç”¨æˆ·ï¼Œæš‚æ—¶ä½¿ç”¨åŸæœ‰çš„ç™»å½•æœºåˆ¶

## äº”ã€åç»­ä¼˜åŒ–æ–¹å‘

å¾…åŸºç¡€åŠŸèƒ½ç¨³å®šè¿è¡Œåï¼Œå¯è€ƒè™‘ä»¥ä¸‹ä¼˜åŒ–ï¼š

1. **å¤šå®‰å…¨é—®é¢˜æ”¯æŒ**ï¼š
   - åˆ›å»ºç‹¬ç«‹çš„å®‰å…¨é—®é¢˜è¡¨
   - æ”¯æŒç”¨æˆ·è®¾ç½®å¤šä¸ªé—®é¢˜ï¼ŒéšæœºæŠ½å–éªŒè¯

2. **éªŒè¯è®°å½•è¿½è¸ª**ï¼š
   - æ·»åŠ éªŒè¯å°è¯•è®°å½•è¡¨
   - å®ç°æ›´ç²¾ç»†çš„å®‰å…¨æ§åˆ¶ç­–ç•¥

3. **æ™ºèƒ½é£é™©è¯„ä¼°**ï¼š
   - æ ¹æ®IPå˜åŒ–ç¨‹åº¦ã€æ—¶é—´å› ç´ è¯„ä¼°é£é™©çº§åˆ«
   - å¯¹ä½é£é™©ç™»å½•å‡å°‘éªŒè¯é¢‘ç‡ 